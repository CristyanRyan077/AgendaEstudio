<UserControl x:Class="AgendaWPF.Controles.HistoricoCliente"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:AgendaWPF.Controles" xmlns:models="clr-namespace:AgendaWPF.Models" d:DataContext="{d:DesignInstance Type=models:AgendamentoVM}"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <!-- ================== RESOURCES ================== -->
    <UserControl.Resources>
        <!-- Cores/tokens -->
        <SolidColorBrush x:Key="CardBg" Color="#FFFFFFFF"/>
        <SolidColorBrush x:Key="CardBorder" Color="#D6D9DF"/>
        <CornerRadius   x:Key="CardRadius">12</CornerRadius>


        <!-- Chip base -->
        <Style x:Key="ChipStyle" TargetType="Border">
            <Setter Property="Padding" Value="2,0"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Margin" Value="0,0,6,0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Background" Value="#ECEFF1"/>
            <Setter Property="BorderBrush" Value="#CFD8DC"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>


        <!-- Chip de Status com cores por estado -->
        <Style x:Key="StatusChip" TargetType="Border" BasedOn="{StaticResource ChipStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Status}" Value="Pendente">
                    <Setter Property="Background" Value="#FFF8E1"/>
                    <Setter Property="BorderBrush" Value="#FFC107"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Concluido">
                    <Setter Property="Background" Value="#E8F5E9"/>
                    <Setter Property="BorderBrush" Value="#4CAF50"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Cancelado">
                    <Setter Property="Background" Value="#FFEBEE"/>
                    <Setter Property="BorderBrush" Value="#E53935"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Card do histórico -->
        <Style x:Key="HistoryCard" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource CardBg}"/>
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="{StaticResource CardRadius}"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding EstaSendoEditado}" Value="True">
                    <Setter Property="BorderBrush" Value="#2196F3"/>
                    <Setter Property="BorderThickness" Value="2"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Trilho colorido à esquerda, por status -->
        <Style x:Key="StatusStripe" TargetType="Border">
            <Setter Property="Width" Value="4"/>
            <Setter Property="CornerRadius" Value="3"/>
            <Setter Property="Margin" Value="0,0,10,0"/>
            <Setter Property="Background" Value="#B0BEC5"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Status}" Value="Pendente">
                    <Setter Property="Background" Value="#FFC107"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Concluido">
                    <Setter Property="Background" Value="#4CAF50"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Cancelado">
                    <Setter Property="Background" Value="#E53935"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>



    <Grid Background="#333">
        <Grid Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>


            <TextBlock Text="Histórico de Agendamentos"
                             FontSize="18" FontWeight="Bold" Foreground="White"
                             Margin="10" Grid.Row="0"/>

            <!-- Lista (substitui ScrollViewer + ItemsControl) -->
            <!-- ================== LISTBOX ================== -->
            <ListBox Grid.Row="1"
       ItemsSource="{Binding HistoricoAgendamentos}"
       Background="Transparent"
       BorderThickness="0"
       ScrollViewer.VerticalScrollBarVisibility="Auto"
       VirtualizingPanel.IsVirtualizing="True" Height="500"
       VirtualizingPanel.VirtualizationMode="Recycling"
       ScrollViewer.CanContentScroll="True">
                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem">
                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        <Setter Property="VerticalContentAlignment"   Value="Stretch"/>
                        <Setter Property="Padding" Value="2"/>
                        <Setter Property="Margin"  Value="2"/>
                    </Style>
                </ListBox.ItemContainerStyle>

                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <!-- Clique em qualquer lugar do card -->
                        <Border 
                                Padding="0" Background="Transparent" BorderThickness="0"
                                Cursor="Hand" HorizontalAlignment="Stretch">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- trilho de status -->
                                <Border Grid.Column="0" Style="{StaticResource StatusStripe}"/>

                                <!-- card -->
                                <Border Grid.Column="1" Style="{StaticResource HistoryCard}">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- linha 1: data / hora -->
                                        <Grid Grid.Row="0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
  
                                            <TextBlock Text="{Binding Servico.Nome}"
                                                       FontSize="16" 
                                                       FontWeight="SemiBold"/>
                                            
                                            <Border Grid.Column="1" Margin="0,0,10,0" Style="{StaticResource StatusChip}">
                                                <TextBlock Text="{Binding Status}" />
                                            </Border>
                                            
                                            <StackPanel Orientation="Horizontal" Grid.Column="2">
                                      
                                                <TextBlock  FontSize="16" Text="{Binding Data, StringFormat='{}{0:dd/MM/yyyy}'}"
                                                            Margin="0,0,10,0"  FontWeight="SemiBold" />
                                                <TextBlock  FontWeight="SemiBold" FontSize="16" Text="{Binding Horario, StringFormat='{}{0:hh\\:mm}'}"
                                                HorizontalAlignment="Center" />
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Grid.Row="1">
                                                <TextBlock Text="Tema: "/>
                                                <TextBlock Text="{Binding Tema}"/>
                                            </StackPanel>
            
                                                          
                                        </Grid>

                                      


                                        <StackPanel Grid.Row="1" Orientation="Horizontal">


                                            <TextBlock Text="{Binding Crianca.Nome}"
                                                      FontSize="15"
                                                      Foreground="#263238" />
                                            <TextBlock Text=" -" FontSize="15" Margin="0,0,6,0"/>
                                            <TextBlock Text="{Binding MesversarioFormatado}" FontSize="15"/>
                                        </StackPanel>


                                        <!-- linha 4: pagamento + progressbar -->
                                        <StackPanel Grid.Row="2">

                                            <TextBlock Margin="0,4,0,5">
                                                    <Run Text="Pago: "/>
                                                    <Run Text="{Binding ValorPago, Mode=OneWay, StringFormat=R$ {0:N2}}"/>
                                                    <Run Text=" / "/>
                                                    <Run Text="{Binding Valor, StringFormat=R$ {0:N2}}"/>
                                            </TextBlock>
                                            <ProgressBar Height="12" Width="150" HorizontalAlignment="Left"
                                                       Maximum="{Binding Valor}" Margin="0,0,0,10"
                                                       Value="{Binding ValorPago, Mode=OneWay}"/>
                                        </StackPanel>
                                        <StackPanel Grid.Row="3">
                                            <TextBlock Text="Anotações:"/>
                                            <TextBlock Text="{Binding Observacao}"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Grid>
    </Grid>
</UserControl>
